= Pods and Services
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Pods

In Kubernetes environments, like OpenShift, a pod is a group of shared
link:containers_and_images.html#containers[docker containers] on a host, and the
smallest deployable unit that can be created, scheduled, and managed.

Each pod has its own IP address, therefore owning its entire port space, and
containers within pods can share storage. Pods can be "tagged" with one or more
labels, which are then used to select and manage groups of pods in a single
operation.

.Pod Object Definition
====

[source,json]
----
{
  "kind": "Pod",
  "apiVersion": "v1",
  "metadata": {
    "name": "e9bae2ce-9761-11e4-86f8-f0def1de880f",
    "namespace": "default",
    "selfLink": "/api/v1/namespaces/default/pods/e9bae2ce-9761-11e4-86f8-f0def1de880f",
    "uid": "e9bae2ce-9761-11e4-86f8-f0def1de880f",
    "resourceVersion": "14",
    "creationTimestamp": "2015-01-08T18:12:31Z",
    "annotations": {
      "deployment": "docker-registry-1" <1>
    }
  },
  "spec": {
    "containers": [
      {
        "name": "deployment",
        "image": "openshift/origin-deployer", <2>
        "env": [
          {
            "name": "OPENSHIFT_DEPLOYMENT_NAME",
            "value": "docker-registry-1"
          },
          {
            "name": "OPENSHIFT_DEPLOYMENT_NAMESPACE",
            "value": "default"
          },
          {
            "name": "KUBERNETES_MASTER",
            "value": "http://10.18.57.24:8080"
          },
          {
            "name": "OPENSHIFT_MASTER",
            "value": "http://10.18.57.24:8080"
          }
        ],
        "resources": {},
        "terminationMessagePath": "/dev/termination-log",
        "imagePullPolicy": "IfNotPresent",
        "securityContext": {
          "capabilities": {},
          "privileged": false
        }
      }
    ],
    "restartPolicy": "Never",
    "dnsPolicy": "ClusterFirst"
  },
  "status": {
    "phase": "Failed",
    "podIP": "172.17.0.2",
    "containerStatuses": [
      {
        "name": "deployment",
        "state": {
          "termination": {
            "exitCode": 255,
            "startedAt": "2015-01-08T18:12:41Z",
            "finishedAt": "2015-01-08T18:12:42Z"
          }
        },
        "lastState": {},
        "ready": false,
        "restartCount": 0,
        "image": "openshift/origin-deployer",
        "imageID": "",
        "containerID": "docker://0d9b9c3dee08c6b5f22ef5d6fcba2f3991d713c6b337d036d5434b496ae207ef"
      },
      {
        "name": "net",
        "state": {
          "running": {
            "startedAt": "2015-01-13T12:10:50Z"
          }
        },
        "lastState": {},
        "ready": false,
        "restartCount": 1,
        "image": "kubernetes/pause:latest",
        "imageID": "",
        "containerID": "docker://4617946052b093310d14516e14279232da1a220bcf81a46b50dc94ae11065ea2"
      }
    ]
  }
}
----

====
<1> The labels are stored in key/value format in the `*annotation*` hash. The
label in this example is *deployment=docker-registry-1*.
<2> The docker image(s) that define the pod are provided in the `containers`
list along with related environment variable mappings.

== Services

A service identifies a set of link:#pods[pods] and proxies the connections it
receives to them. Pods can be added or taken away from a service any number of
times.

Services assign clients an IP address and port pair that, when accessed,
redirect to the appropriate back end. A service uses a label selector to find
all the containers running that provide a certain network service on a certain
port. The service is then bound to a local port, so to access the service from
inside your application or container you simply bind to the local network on the
port number for the service.

Like pods, services are REST objects. To create a new service, a service
definition can be sent to the API server using a `POST` operation. The following
example shows the definition of a service with a name of *frontend*, which
forwards to container TCP port *8080* on any pod with the *name=frontend* label
attached:

.Service Object Definition
====

[source,json]
----
{
  "kind": "Service",
  "apiVersion": "v1",
  "metadata": {
    "name": "frontend",
    "namespace": "myproject", <1>
    "selfLink": "/api/v1/namespaces/myproject/services/frontend",
    "uid": "cb733818-ea98-11e4-a239-0800279696e1",
    "resourceVersion": "204",
    "creationTimestamp": "2015-04-24T15:44:29Z",
    "labels": {
      "template": "application-template-dockerbuild"
    }
  },
  "spec": {
    "ports": [
      {
        "protocol": "TCP",
        "port": 5432, <2>
        "targetPort": 8080, <3>
        "nodePort": 0
      }
    ],
    "selector": {
      "name": "frontend" <4>
    },
    "portalIP": "172.30.217.106", <5>
    "type": "ClusterIP",
    "sessionAffinity": "None"
  }
}
----

<1> Service name of *frontend*.
<2> Port the service runs on.
<3> Port on the container to which the service forwards connections.
<4> Label selector finds all containers with the *name=frontend* label attached.
<5> Virtual IP of the service. Automatically assigned by the Kubernetes master
at creation and used by
link:../infrastructure_components/kubernetes_infrastructure.html#service-proxy[service
proxies].
====

See the
https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/services.md[Kubernetes
documentation] for more information on services.

== Labels

Labels are used to organize, group, or select objects and resources, such as
pods. Pods are "tagged" with labels, and then services and replication
controllers use labels to indicate the pods they relate to. This makes it
possible for services and replication controllers to reference groups of pods,
or treat pods with potentially different docker containers as similar entities.

Labels are a key/value pair, and shown in the following example:

====

[source,json]
----

"labels": {
  "key1" : "value1",
  "key2" : "value2"
}
----

====

Consider:

- A pod consisting of an *nginx* docker container, with the label
*role=webserver*.
- A pod consisting of an *Apache* docker container, with the same label
*role=webserver*.

A service or replication controller that is defined to use pods with the
`role=webserver` label treats both of these pods as part of the same group.

See the
https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/labels.md[Kubernetes
documentation] for more information on labels.
